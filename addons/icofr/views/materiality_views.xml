<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Materiality Calculator Views -->

    <!-- Form View -->
    <record id="view_icofr_materiality_form" model="ir.ui.view">
        <field name="name">icofr.materiality.form</field>
        <field name="model">icofr.materiality</field>
        <field name="arch" type="xml">
            <form string="Kalkulator Materialitas ICORF" create="false" edit="false">
                <header>
                    <button name="action_calculate_materiality" type="object" string="Hitung Ulang Materialitas" class="oe_highlight"/>
                    <button name="action_update_balances_from_erp" type="object" string="Tarik Saldo dari ERP" class="btn-success" icon="fa-refresh"/>
                    <button name="%(action_icofr_financial_data_import_wizard)d" type="action" string="Import Data Keuangan (Excel)" class="btn-primary" icon="fa-upload" context="{'default_materiality_id': id}"/>
                    <button name="action_export_materiality" type="object" string="Ekspor"/>
                    <button name="%(action_icofr_account_mapping_upload_wizard)d" type="action" string="Upload Excel Pemetaan Akun" class="btn-primary"/>
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                        </button>
                    </div>
                    <group>
                        <group>
                            <field name="company_id"/>
                            <field name="is_new_acquisition"/>
                            <field name="fiscal_year"/>
                        </group>
                        <group string="Konfigurasi Grup (Tabel 25)">
                            <field name="is_group_consolidation"/>
                            <field name="number_of_significant_locations" invisible="not is_group_consolidation"/>
                            <field name="group_multiplier" invisible="not is_group_consolidation"/>
                        </group>
                        <group>
                            <field name="materiality_basis"/>
                        </group>
                    </group>
                    
                    <group string="Basis Perhitungan">
                        <group>
                            <field name="revenue_amount" widget="monetary"/>
                            <field name="total_assets_amount" widget="monetary"/>
                        </group>
                        <group>
                            <field name="net_income_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <group name="materiality_parameters" string="Parameter Materialitas">
                        <group>
                            <field name="overall_materiality_percent"/>
                            <field name="overall_materiality_amount" widget="monetary"/>
                            <field name="sad_percent"/>
                            <field name="sad_amount" widget="monetary"/>
                        </group>
                        <group>
                            <field name="risk_factor_level" widget="radio"/>
                            <field name="performance_materiality_percent"/>
                            <field name="performance_materiality_amount" widget="monetary"/>
                        </group>
                    </group>

                    <group string="Scoping Coverage Analysis (Aturan 2/3)" name="coverage_analysis" class="oe_edit_only">
                        <group>
                            <field name="coverage_revenue_percent" widget="progressbar"/>
                            <field name="coverage_assets_percent" widget="progressbar"/>
                        </group>
                        <group>
                            <field name="coverage_status" widget="badge" decoration-success="coverage_status == 'pass'" decoration-danger="coverage_status == 'fail'"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Catatan Perhitungan">
                            <field name="notes"/>
                        </page>
                        <page string="Pemetaan Akun">
                            <field name="account_mapping_ids">
                                <list editable="top">
                                    <field name="entity_code"/>
                                    <field name="gl_account"/>
                                    <field name="account_balance" sum="Total Saldo"/>
                                    <field name="fsl_item" string="FSLI"/>
                                    <field name="is_quantitative_significant" string="Quant" readonly="1"/>
                                    <field name="is_qualitative_significant" string="Qual" readonly="1"/>
                                    <field name="is_in_scope" string="In Scope" readonly="1"/>
                                    <field name="status"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter"/>
            </form>
        </field>
    </record>

    <!-- Tree/List View -->
    <record id="view_icofr_materiality_tree" model="ir.ui.view">
        <field name="name">icofr.materiality.tree</field>
        <field name="model">icofr.materiality</field>
        <field name="arch" type="xml">
            <list string="Kalkulator Materialitas">
                <header>
                    <button name="%(action_icofr_financial_data_import_wizard)d" type="action" string="Import General Ledger (Excel)" class="btn-primary" icon="fa-upload"/>
                </header>
                <field name="name"/>
                <field name="fiscal_year"/>
                <field name="company_id"/>
                <field name="overall_materiality_amount" widget="monetary"/>
                <field name="performance_materiality_amount" widget="monetary"/>
                <field name="materiality_basis"/>
                <field name="create_date"/>
            </list>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_icofr_materiality_search" model="ir.ui.view">
        <field name="name">icofr.materiality.search</field>
        <field name="model">icofr.materiality</field>
        <field name="arch" type="xml">
            <search string="Cari Kalkulasi Materialitas">
                <field name="name"/>
                <field name="fiscal_year"/>
                <field name="company_id"/>
            </search>
        </field>
    </record>

    <!-- Action Window -->
    <record id="action_icofr_materiality" model="ir.actions.act_window">
        <field name="name">Kalkulator Materialitas</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">icofr.materiality</field>
        <field name="view_mode" >list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Tambahkan kalkulasi materialitas pertama Anda!
            </p><p>
                Kalkulator materialitas digunakan untuk menghitung Overall Materiality dan Performance Materiality
                berdasarkan data laporan keuangan perusahaan.
            </p>
        </field>
    </record>

    <!-- Materiality Menu Items -->
    <menuitem id="menu_icofr_materiality" 
              name="Kalkulator Materialitas"
              parent="menu_icofr_master"
              action="action_icofr_materiality"
              sequence="30"/>

    <!-- Account Mapping Views -->

    <!-- Account Mapping Form View -->
    <record id="view_icofr_account_mapping_form" model="ir.ui.view">
        <field name="name">icofr.account.mapping.form</field>
        <field name="model">icofr.account.mapping</field>
        <field name="arch" type="xml">
            <form string="Pemetaan Akun GL ke FSLI">
                <header>
                    <button name="action_validate_mapping" type="object" string="Validasi Pemetaan" class="oe_highlight"/>
                    <button name="action_generate_questions" type="object" string="Generate Kuesioner" class="btn-secondary"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="code"/>
                            <field name="sequence"/>
                        </group>
                        <group>
                            <field name="status"/>
                            <field name="account_balance"/>
                        </group>
                    </group>
                    <group>
                        <group string="Detail Akun">
                            <field name="entity_code"/>
                            <field name="gl_account"/>
                            <field name="account_gl_id"/>
                            <field name="gl_account_description"/>
                            <field name="account_description"/>
                        </group>
                        <group string="FSLI (Financial Statement Line Item)">
                            <field name="fsl_item"/>
                            <field name="fsl_description"/>
                        </group>
                    </group>
                    
                    <group string="Matriks Signifikansi (Dokumen 4)">
                        <group string="Signifikansi Kuantitatif">
                            <field name="is_quantitative_significant" readonly="1"/>
                            <field name="account_balance"/>
                        </group>
                        <group string="Signifikansi Kualitatif (5 Pilar)">
                            <field name="has_fraud_risk" string="Kecurangan (Fraud)"/>
                            <field name="is_volume_high" string="Volume Transaksi"/>
                            <field name="is_complex_transaction" string="Kompleksitas"/>
                            <field name="is_characteristic_specific" string="Karakteristik Risiko"/>
                            <field name="is_volatile" string="Volatilitas"/>
                            <field name="is_qualitative_significant" readonly="1"/>
                        </group>
                    </group>
                    <group string="Hasil Scoping">
                        <group>
                            <field name="is_in_scope" widget="boolean_toggle" readonly="1"/>
                        </group>
                        <group>
                            <field name="qualitative_justification" invisible="not is_qualitative_significant"/>
                        </group>
                    </group>
                    <group string="Faktor Kualitatif Lainnya (Tabel 5)" optional="hide" collapsed="1">
                        <group>
                            <field name="is_construction_wip"/>
                            <field name="is_held_by_third_party"/>
                            <field name="is_loan_covenant"/>
                        </group>
                        <group>
                            <field name="is_onerous_contract"/>
                            <field name="is_asset_impairment"/>
                            <field name="is_complex_estimate"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Asesmen Kualitatif (Detail)">
                            <field name="qualitative_assessment_ids">
                                <list editable="top">
                                    <field name="question"/>
                                    <field name="answer"/>
                                    <field name="score"/>
                                    <field name="notes"/>
                                </list>
                            </field>
                        </page>
                        <page string="Proses Terkait">
                            <field name="process_ids" widget="many2many_tags"/>
                        </page>
                        <page string="Risiko Terkait">
                            <field name="risk_ids" widget="many2many_tags"/>
                        </page>
                        <page string="Kontrol Terkait">
                            <field name="control_ids" widget="many2many_tags"/>
                        </page>
                        <page string="Catatan">
                            <field name="notes"/>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>

    <!-- Account Mapping Tree View -->
    <record id="view_icofr_account_mapping_tree" model="ir.ui.view">
        <field name="name">icofr.account.mapping.tree</field>
        <field name="model">icofr.account.mapping</field>
        <field name="arch" type="xml">
            <list string="Pemetaan Akun GL ke FSLI">
                <header>
                    <button name="%(action_icofr_account_mapping_upload_wizard)d" type="action" string="Import Template Laporan (Excel)" class="btn-primary" icon="fa-table"/>
                </header>
                <field name="entity_code"/>
                <field name="gl_account"/>
                <field name="name" optional="hide"/>
                <field name="fsl_item" string="Kode FSLI"/>
                <field name="account_balance" sum="Total Saldo" widget="monetary"/>
                <field name="is_quantitative_significant" string="Kuantitatif" widget="boolean_toggle"/>
                <field name="has_fraud_risk" string="Fraud" optional="show"/>
                <field name="is_volume_high" string="Volume" optional="show"/>
                <field name="is_complex_transaction" string="Kompleksitas" optional="show"/>
                <field name="is_characteristic_specific" string="Karakteristik" optional="show"/>
                <field name="is_volatile" string="Volatilitas" optional="show"/>
                <field name="is_qualitative_significant" string="Kualitatif" widget="boolean_toggle"/>
                <field name="is_in_scope" string="In-Scope" widget="boolean_toggle" decoration-success="is_in_scope" decoration-muted="not is_in_scope"/>
                <field name="status" widget="badge" optional="hide"/>
            </list>
        </field>
    </record>

    <!-- Account Mapping Search View -->
    <record id="view_icofr_account_mapping_search" model="ir.ui.view">
        <field name="name">icofr.account.mapping.search</field>
        <field name="model">icofr.account.mapping</field>
        <field name="arch" type="xml">
            <search string="Cari Pemetaan Akun">
                <field name="name"/>
                <field name="code"/>
                <field name="gl_account"/>
                <field name="fsl_item"/>
                <field name="status"/>
                <field name="is_in_scope"/>
            </search>
        </field>
    </record>

    <!-- Account Mapping Action -->
    <record id="action_icofr_account_mapping" model="ir.actions.act_window">
        <field name="name">Pemetaan Akun GL ke FSLI</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">icofr.account.mapping</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Tambahkan pemetaan akun pertama Anda!
            </p><p>
                Pemetaan akun GL ke FSLI digunakan untuk menghubungkan akun buku besar ke
                item laporan keuangan sesuai dengan standar POJK 15/2024.
            </p>
        </field>
    </record>

    <!-- Account Mapping Menu -->
    <menuitem id="menu_icofr_account_mapping"
              name="Pemetaan Akun GL-FSLI"
              parent="menu_icofr_master"
              action="action_icofr_account_mapping"
              sequence="31"/>

</odoo>
