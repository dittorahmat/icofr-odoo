<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Icofr Testing Views -->
    <record id="view_icofr_testing_list" model="ir.ui.view">
        <field name="name">icofr.testing.list</field>
        <field name="model">icofr.testing</field>
        <field name="arch" type="xml">
            <list string="Pengujian Kontrol">
                <field name="name"/>
                <field name="control_id"/>
                <field name="test_date"/>
                <field name="tester_id"/>
                <field name="status"/>
            </list>
        </field>
    </record>

    <record id="view_icofr_testing_form" model="ir.ui.view">
        <field name="name">icofr.testing.form</field>
        <field name="model">icofr.testing</field>
        <field name="arch" type="xml">
            <form string="Pengujian Kontrol">
                <header>
                    <field name="status" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                    </div>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="control_id"/>
                            <field name="test_type"/>
                            <field name="tester_id"/>
                        </group>
                        <group>
                            <field name="test_date"/>
                            <field name="effectiveness"/>
                            <field name="status"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Validasi Rancangan (Test of One)" invisible="test_type != 'design_validation'">
                            <group>
                                <field name="design_validation_conclusion" widget="radio" options="{'horizontal': true}"/>
                                <field name="sample_size_calculated" readonly="1" string="Jumlah Sampel (Wajib 1)"/>
                            </group>
                        </page>
                        <page string="Test of Design (TOD)" invisible="test_type != 'tod'">
                            <group>
                                <field name="design_description" placeholder="Evaluasi rancangan pengendalian..."/>
                                <field name="design_conclusion" widget="radio" options="{'horizontal': true}"/>
                            </group>
                        </page>
                        <page string="Test of Operating Effectiveness (TOE)" invisible="test_type != 'toe'">
                            <group>
                                <group string="Sampling &amp; Populasi">
                                    <field name="population_reference"/>
                                    <field name="sample_selection_method"/>
                                    <field name="sample_size"/>
                                </group>
                                <group string="Hasil Eksekusi">
                                    <field name="testing_steps"/>
                                    <field name="exceptions_noted"/>
                                </group>
                            </group>
                            <div class="mb-2">
                                <button name="%(icofr.action_icofr_sample_selection_wizard)d" 
                                        type="action" string="Pilih Sampel dari Populasi" 
                                        class="btn-secondary mr-2" icon="fa-plus-circle"
                                        context="{'default_testing_id': id}"/>
                                <button name="%(icofr.action_icofr_population_pull_erp_wizard)d" 
                                        type="action" string="Tarik Data dari ERP" 
                                        class="btn-primary" icon="fa-database"
                                        context="{'default_testing_id': id, 'default_control_id': control_id}"/>
                            </div>
                        </page>
                        <page string="Sampel Terpilih (Testing Log)" invisible="test_type != 'toe'">
                            <field name="sample_ids">
                                <list editable="bottom">
                                    <field name="transaction_no" readonly="1"/>
                                    <field name="transaction_date" readonly="1"/>
                                    <field name="amount" readonly="1"/>
                                    <field name="description" readonly="1"/>
                                    <field name="testing_result"/>
                                    <field name="testing_notes"/>
                                </list>
                            </field>
                        </page>
                        <page string="Detail Prosedur &amp; Hasil">
                            <field name="testing_procedures"/>
                            <field name="test_results"/>
                        </page>
                        <page string="Kalkulator Sampling (Tabel 22 Juknis)" invisible="test_type != 'toe'">
                            <group>
                                <group>
                                    <field name="control_frequency"/>
                                    <field name="population_size"/>
                                    <field name="confidence_level"/>
                                </group>
                                <group>
                                    <field name="sample_size_calculated"/>
                                    <field name="sampling_method"/>
                                </group>
                            </group>
                        </page>
                        <page string="Temuan &amp; Rekomendasi">
                            <group>
                                <field name="findings"/>
                                <field name="recommendation"/>
                            </group>
                        </page>
                        <page string="Lampiran Bukti">
                            <field name="evidence_attachment_ids" widget="many2many_binary"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_icofr_testing_search" model="ir.ui.view">
        <field name="name">icofr.testing.search</field>
        <field name="model">icofr.testing</field>
        <field name="arch" type="xml">
            <search string="Pengujian Kontrol">
                <field name="name"/>
            </search>
        </field>
    </record>

    <!-- Action untuk Icofr Testing -->
    <record id="action_icofr_testing" model="ir.actions.act_window">
        <field name="name">Pengujian Kontrol</field>
        <field name="res_model">icofr.testing</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Tambahkan pengujian kontrol pertama anda!
            </p><p>
                Pengujian kontrol digunakan untuk mengevaluasi efektivitas
                kontrol internal terhadap risiko finansial.
            </p>
        </field>
    </record>

    <!-- Menu item untuk Pengujian Kontrol -->
    <menuitem id="menu_icofr_testing"
              name="Pengujian Kontrol"
              sequence="51"
              parent="menu_icofr_operational"
              action="action_icofr_testing"/>
</odoo>