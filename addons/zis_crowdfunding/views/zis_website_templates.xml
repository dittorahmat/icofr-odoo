<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Add ZIS assets to website pages -->
    <template id="zis_add_assets" inherit_id="website.layout" name="ZIS Assets">
        <xpath expr="//head" position="inside">
            <link rel="stylesheet" type="text/scss" href="/zis_crowdfunding/static/src/scss/zis_styles.scss"/>
            <script type="text/javascript" src="/zis_crowdfunding/static/src/js/zis_scripts.js"/>
        </xpath>
    </template>
    
    <!-- Website page for ZIS campaigns -->
    <template id="zis_campaign_page">
        <t t-call="website.layout">
            <div class="oe_structure"/>
            <div class="container mt-5">
                <h1 class="text-center mb-5">Kampanye ZIS Terbaru</h1>
                <div class="row">
                    <t t-foreach="campaigns" t-as="campaign">
                        <div class="col-md-4 mb-4">
                            <div class="card h-100">
                                <t t-if="campaign.image">
                                    <img t-attf-src="/web/image/zis.campaign/#{campaign.id}/image" class="card-img-top" style="height: 200px; object-fit: cover;" alt="Gambar Kampanye"/>
                                </t>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title"><t t-esc="campaign.name"/></h5>
                                    <p class="card-text">
                                        <span t-if="campaign.zis_type == 'zakat'">Zakat</span>
                                        <span t-if="campaign.zis_type == 'infaq'">Infaq</span>
                                        <span t-if="campaign.zis_type == 'shodaqoh'">Shodaqoh</span>
                                    </p>
                                    <div class="mt-2">
                                        <div class="progress mb-2">
                                            <div class="progress-bar" role="progressbar" 
                                                 t-att-style="campaign.target_amount and 'width: '+ str(int((campaign.collected_amount/campaign.target_amount)*100)) +'%' or 'width: 0%'"
                                                 t-att-aria-valuenow="campaign.target_amount and int((campaign.collected_amount/campaign.target_amount)*100) or 0" 
                                                 aria-valuemin="0" aria-valuemax="100">
                                                <t t-esc="campaign.target_amount and int((campaign.collected_amount/campaign.target_amount)*100) or 0"/>%
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <small>Terkumpul: <t t-esc="campaign.collected_amount" t-options='{"widget": "monetary", "display_currency": env.company.currency_id, "field_options": {"precision": 0}}'/></small>
                                            <small>Target: <t t-esc="campaign.target_amount" t-options='{"widget": "monetary", "display_currency": env.company.currency_id, "field_options": {"precision": 0}}'/></small>
                                        </div>
                                    </div>
                                    <a t-att-href="'/donasi/'+str(campaign.id)" class="btn btn-primary mt-auto">Donasi Sekarang</a>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
            <div class="oe_structure"/>
        </t>
    </template>

    <!-- Donation form page -->
    <template id="zis_donation_form" name="ZIS Donation Form">
        <t t-call="website.layout">
            <div class="oe_structure"/>
            <div class="container-fluid mt-4">
                <div class="row mb-4">
                    <div class="col-12">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/zis-campaigns">Kampanye ZIS</a></li>
                                <li class="breadcrumb-item active"><t t-esc="campaign.name"/></li>
                                <li class="breadcrumb-item">Donasi</li>
                            </ol>
                        </nav>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="card shadow">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-5">
                                        <t t-if="campaign.image">
                                            <img t-attf-src="/web/image/zis.campaign/#{campaign.id}/image" class="img-fluid rounded" alt="Gambar Kampanye"/>
                                        </t>
                                    </div>
                                    <div class="col-md-7">
                                        <h4 class="text-primary"><t t-esc="campaign.name"/></h4>
                                        <p class="text-muted mb-3"><t t-esc="campaign.description"/></p>
                                        
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between mb-1">
                                                <small>Tercapai:</small>
                                                <small><t t-esc="campaign.collected_amount" t-options='{"widget": "monetary", "display_currency": env.company.currency_id, "field_options": {"precision": 0}}'/> dari <t t-esc="campaign.target_amount" t-options='{"widget": "monetary", "display_currency": env.company.currency_id, "field_options": {"precision": 0}}'/></small>
                                            </div>
                                            <div class="progress" style="height: 20px;">
                                                <div class="progress-bar bg-success" role="progressbar" 
                                                     t-att-style="campaign.target_amount and 'width: '+ str(int((campaign.collected_amount/campaign.target_amount)*100)) +'%' or 'width: 0%'"
                                                     t-att-aria-valuenow="campaign.target_amount and int((campaign.collected_amount/campaign.target_amount)*100) or 0" 
                                                     aria-valuemin="0" aria-valuemax="100">
                                                    <t t-esc="campaign.target_amount and int((campaign.collected_amount/campaign.target_amount)*100) or 0"/>%
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row text-center mb-3">
                                            <div class="col-4">
                                                <div class="border rounded p-2">
                                                    <h6 class="text-success"><t t-esc="campaign.target_amount" t-options='{"widget": "monetary", "display_currency": env.company.currency_id, "field_options": {"precision": 0}}'/></h6>
                                                    <small>Target</small>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="border rounded p-2">
                                                    <h6 class="text-info"><t t-esc="campaign.collected_amount" t-options='{"widget": "monetary", "display_currency": env.company.currency_id, "field_options": {"precision": 0}}'/></h6>
                                                    <small>Terkumpul</small>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="border rounded p-2">
                                                    <h6 class="text-warning"><t t-esc="campaign.target_amount - campaign.collected_amount" t-options='{"widget": "monetary", "display_currency": env.company.currency_id, "field_options": {"precision": 0}}'/></h6>
                                                    <small>Butuh Lagi</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h5>Form Donasi</h5>
                                    <form action="/submit-donation" method="post" class="mt-3">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        <input type="hidden" name="campaign_id" t-att-value="campaign.id"/>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label for="donator_name">Nama Donatur *</label>
                                                    <input type="text" class="form-control" id="donator_name" name="donator_name" required="required" placeholder="Nama Anda"/>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label for="donation_type">Jenis ZIS *</label>
                                                    <select class="form-control" id="donation_type" name="donation_type" required="required">
                                                        <option value="">Pilih Jenis ZIS</option>
                                                        <option value="zakat">Zakat</option>
                                                        <option value="infaq">Infaq</option>
                                                        <option value="shodaqoh">Shodaqoh</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group mb-4">
                                            <label for="amount">Nominal Donasi *</label>
                                            <input type="number" class="form-control" id="amount" name="amount" min="1000" step="1000" required="required" placeholder="Contoh: 50.000"/>
                                            <div class="form-text">Minimal donasi: Rp 1.000</div>
                                        </div>
                                        
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-success btn-lg">Donasi Sekarang</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card shadow">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">Detail Kampanye</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>Jenis:</strong>
                                        <span class="float-end">
                                            <t t-if="campaign.zis_type == 'zakat'">Zakat</t>
                                            <t t-if="campaign.zis_type == 'infaq'">Infaq</t>
                                            <t t-if="campaign.zis_type == 'shodaqoh'">Shodaqoh</t>
                                        </span>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Kategori:</strong>
                                        <span class="float-end" t-esc="campaign.category_id.name"/>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Tanggal Mulai:</strong>
                                        <span class="float-end" t-esc="campaign.start_date"/>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Tanggal Berakhir:</strong>
                                        <span class="float-end" t-esc="campaign.end_date"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="card shadow mt-4">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">Cara Berdonasi</h5>
                            </div>
                            <div class="card-body">
                                <ol>
                                    <li>Isi formulir di samping</li>
                                    <li>Pilih jenis ZIS (Zakat, Infaq, Shodaqoh)</li>
                                    <li>Masukkan nominal donasi</li>
                                    <li>Klik "Donasi Sekarang"</li>
                                    <li>Donasi Anda akan langsung tercatat</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="oe_structure"/>
        </t>
    </template>
</odoo>